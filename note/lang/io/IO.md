### NIO
FileChannel 是不支持非阻塞的。

### 同步异步/阻塞非阻塞
- 同步异步关注的是消息通信机制  
一个人要烧开一壶水，有很多种方式。  
这个人开火烧水，还得这个人本人监督着直到水烧开，这是同步。  
这个人把水放在水上烧，水烧开后不一定由这个人处理，这叫异步。
- 阻塞非阻塞关注的是等待消息时的状态  
这个人在等水烧开的过程中什么事情都不干，就等着水烧开，这叫阻塞。  
如果这个人还去做其他的事情，这叫做非阻塞。
> 同步异步，阻塞非阻塞的不同在于他们对信息的关注点不同。
- 同步阻塞  
一个人烧水，在水烧开之前，他就一直在旁边等着，什么时候水烧开了他才进行下一步的操作，这就是同步阻塞。
- 同步非阻塞  
一个人烧水，在水放到火上后，他就去干别的事情了，但是水开之后还是由这个人处理，这就是同步非阻塞。
- 异步阻塞  
一个人烧水，给烧水的壶设置了一个铃，水开铃就会响，然后就去做别的事情了。水开之后的事情不一定是他处理了。他也可以在旁边等着水烧开。这种情况非常少见。
- 异步非阻塞  
一个人烧水，开火之后设置好水开的处理程序，不由他自己处理。异步非阻塞是经常用到的。
> Linux 内核目前只有同步阻塞IO模型和同步非阻塞IO模型，window才有异步(像响应式编程那样)。这里的同步是指内核只靠诉你数据到达了，还是要程序主动去调用内核读数据。如果开辟新的新的线程去处理读回的数据，那是计算时期模型。
### ServerSocket
- ServerSocket()throws IOException
- ServerSocket(int port)throws IOException
- ServerSocket(int port, int backlog)throws IOException
- ServerSocket(int port, int backlog, InetAddress bindAddr)throws IOException
 1. port服务端要监听的端口；backlog客户端连接请求的队列长度；bindAddr服务端绑定IP。
 2. 如果端口被占用或者没有权限使用某些端口会抛出BindException错误。譬如1~1023的端口需要管理员才拥有权限绑定。
 3. 如果设置端口为0，则系统会自动为其分配一个端口。
 4. bindAddr用于绑定服务器IP，为什么会有这样的设置呢，譬如有些机器有多个网卡。
 5. ServerSocket一旦绑定了监听端口，就无法更改。ServerSocket()可以实现在绑定端口前设置其他的参数。
## 零拷贝
1. 传统 IO 执行的话需要 4 次上下文切换（用户态 -> 内核态 -> 用户态 -> 内核态 -> 用户态）和 4 次拷贝（磁盘文件 DMA 拷贝到内核缓冲区，内核缓冲区 CPU 拷贝到用户缓冲区，用户缓冲区 CPU 拷贝到 Socket 缓冲区，Socket 缓冲区 DMA 拷贝到协议引擎）。
2. mmap 将磁盘文件映射到内存，支持读和写，对内存的操作会反映在磁盘文件上，适合小数据量读写，需要 4 次上下文切换（用户态 -> 内核态 -> 用户态 -> 内核态 -> 用户态）和3 次拷贝（磁盘文件DMA拷贝到内核缓冲区，内核缓冲区 CPU 拷贝到 Socket 缓冲区，Socket 缓冲区 DMA 拷贝到协议引擎）。
 > RocketMQ 中就是使用的 mmap 来提升磁盘文件的读写性能。
3. sendfile 是将读到内核空间的数据，转到网络协议引擎，进行网络发送，适合大文件传输，只需要 2 次上下文切换（用户态 -> 内核态 -> 用户态）和 2 次拷贝（磁盘文件 DMA 拷贝到内核缓冲区，内核缓冲区 DMA 拷贝到协议引擎）。只需要从内核缓冲区拷贝一些 offset 和 length 到 Socket 缓冲区。
 > Kafka 和 Tomcat 内部使用就是 sendFile 这种零拷贝。